require=function(t){};var getMonth=function(t){return 0==t?11:t-1};Date.prototype.minusDay=function(){this.setDate(this.getDate()-1)},Date.prototype.withMonth=function(t){return this.setMonth(getMonth(t)),this},Date.prototype.withDay=function(t){return this.setDate(t),this},Date.prototype.adjustYear=function(t){return(new Date).getMonth()<getMonth(t)&&this.setFullYear(this.getFullYear()-1),this},require("core-js/modules/es6.array.sort"),require("core-js/modules/es6.regexp.replace");var PeriodManager=function(){Period=function(t,e,n){this.id=t,this.start=e,this.end=n};var t=[],e=function(t){return t.replace(/[\s\S]*(\d{2})\/(\d{2})\/(\d{4})[\s\S]*\d{2}\/\d{2}\/\d{4}/,"$2-$1-$3")},n=function(t){return t.replace(/[\s\S]*\d{2}\/\d{2}\/\d{4}[\s\S]*(\d{2})\/(\d{2})\/(\d{4})/,"$2-$1-$3")},o=function(e){for(i=0;i<t.length;i++)if(t[i].start<=e&&e<=t[i].end)return t[i].id;return t[0].id};return function(){if(periodSelect=document.querySelector(".separatorPeriodo + div select"),periodSelect){for(i=0;i<periodSelect.length;i++){var o=periodSelect.options[i],r=o.value,a=o.textContent.trim(),c=new Date(e(a)),u=new Date(n(a));t.push(new Period(r,c,u))}t.sort(function(t,e){return e.id-t.id})}}(),{getPeriod:o}}();require("core-js/modules/es6.regexp.split");var evaluatorHoliday=function(){var t=function(t){if(!localStorage.getItem("holidays")){var e=(new Date).getFullYear(),n="https://raw.githubusercontent.com/erickLFLopes/mentoringSemanal/master/holidays/"+e+".json",o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){for(var e=JSON.parse(this.responseText),n=[],o=0;o<e.length;o++)n.push(e[o].date);localStorage.setItem("holidays",n),t&&t()}},o.open("GET",n,!0),o.send()}},e=function(){for(var t=localStorage.getItem("holidays").split(","),e=[],n=t.length-1;n>=0;n--){var o=t[n].split("/");e.push(new Date(o[2],--o[1],o[0]))}return e},n=function(t){for(var n=e(),o=n.length-1;o>=0;o--)if(t-n[o]==0)return!0;return!1};return function(){var e=(new Date).getUTCFullYear();localStorage.getItem("holidaysYear")&&localStorage.getItem("holidaysYear")==e||(localStorage.setItem("holidaysYear",e),localStorage.removeItem("holidays")),t()}(),function(){localStorage.getItem("holidays")||t()}(),{getHolidays:e,verifyDate:n}}();require("core-js/modules/es6.regexp.replace");var PDF=function(){function t(){var t=n.template,e=n.templateData;for(var o in e){var r="{{"+o+"}}";t=t.replace(r,e[o])}var a=window.open("","","height="+n.widthWindow+",width="+n.heightWindow);a.document.write(t),a.print(),a.document.close()}function e(t,e,o){n.changeTemplate("style",t),n.changeTemplate("title",e),n.changeTemplate("data",o)}var n={heightWindow:700,widthWindow:700,template:"\n            <html>\n                <head>\n                    <style>\n                        {{style}}  \n                    </style>\n                    <title>{{title}}</title>\n                </head>\n                <body>\n                    {{data}}\n                </body>\n            </html>",templateData:{style:"",title:"",data:""},setWidthWindow:function(t){this.widthWindow=t|this.widthWindow},setHeightWindow:function(t){this.heightWindow=t|this.heightWindow},changeTemplate:function(t,e){this.templateData[t]=e}};return{generate:e,print:t,configs:n}}();require("core-js/modules/es6.regexp.split"),require("core-js/modules/es6.regexp.replace"),periodUtils=function(){var t=document.querySelectorAll("select[name=per] option"),e=Array.prototype.slice.call(t),n=function(t){return new Date(t.replace(/(\d{2})\/(\d{2})\/(\d{4})/,"$2-$1-$3"))},o=function(t){return{dates:t.text.replace(/[\s\S]*(\d{2}\/\d{2}\/\d{4})[\s\S]*(\d{2}\/\d{2}\/\d{4})[\s\S]*/g,"$1;$2").split(";"),value:t.value}},r=function(t){return{init:n(t.dates[0]),end:n(t.dates[1]+"  23:59:59"),value:t.value}},a=e.map(o).map(r),i=function(t,e){if(!t)return e;var n=a.filter(function(e){return e.init<=t&&t<=e.end});return n.length>0?n[0].value:e||c},c=i(new Date);return{getPeriod:i}}();var cronosUtil=function(){var t=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],e=["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sabado"],n=(new Date).getMonth(),o=n+1,r=o>0?o-1:11,a=r>0?r-1:11;return{getMonthName:function(e){return t[e>0?e-1:11]},getDayName:function(t){return e[t]},getCurrentMonth:function(){return o},getLastMonth:function(){return r},getTwiceLastMonth:function(){return a},getWeekNeedTime:function(t){return 528*t},getInitialWeek:function(t){return t==o?0:4*(o-(t+1))+parseInt((new Date).getDate()/7)}}}(),viewManager=function(){var t=function(t){return'\n            <button id="Month-'.concat(t,'" style="margin-rigth:1%;">\n                Gerar relatório de ').concat(cronosUtil.getMonthName(t),"\n            </button>\n        ")},e='<div class="marginTop20" style="overflow:hidden; background-color: #E1E0E0; border: 2px solid #E1E0E0;-moz-border-radius: 4px;-webkit-border-radius: 4px;border-radius: 4px;margin-bottom: 10px;">\n            <div style="float:left;width:2%;background-color:#E1E0E0;padding-top:5px;text-align:center">\n            <i class="fa fa-pencil"></i>\n            </div>\n            <div style="float:left;  width:98%; background-color:#fff">        <div style="padding: 10px">\n                <br>\n                '.concat(t(cronosUtil.getTwiceLastMonth()),"\n                ").concat(t(cronosUtil.getLastMonth()),"\n                ").concat(t(cronosUtil.getCurrentMonth()),"\n                </div>\n                </div>\n            \n    </div></div>");return document.querySelector(".PageTitle +div").insertAdjacentHTML("beforeBegin",e),{btnCurrentMonth:document.querySelector("#Month-"+cronosUtil.getCurrentMonth()),btnLastMonth:document.querySelector("#Month-"+cronosUtil.getLastMonth()),btnTwiceLastMonth:document.querySelector("#Month-"+cronosUtil.getTwiceLastMonth()),monthAccumulation:document.querySelector("#month-acc-"+cronosUtil.getCurrentMonth()),lastMonthAccumulation:document.querySelector("#month-acc-"+cronosUtil.getLastMonth())}}();require("core-js/modules/es6.array.sort"),require("core-js/modules/es6.regexp.replace");var search=function(t,e){"use strict";var n=function(t){return("0"+t).slice(-2)},o=function(t){return n(t.getHours())+":"+n(t.getMinutes())},r=function(t){return 528*t},a=((new Date).getMonth(),function(t){return t.querySelector(".TimeINVisualizacao")?t.querySelector(".TimeINVisualizacao").textContent:""}),i=function(t){return t.querySelector(".TimeOUTVisualizacao")?t.querySelector(".TimeOUTVisualizacao").textContent:""},c=function(t){return t.querySelectorAll(".TimeINVisualizacao")[1]?t.querySelectorAll(".TimeINVisualizacao")[1].textContent:""},u=function(t){return t.querySelectorAll(".TimeOUTVisualizacao")[1]?t.querySelectorAll(".TimeOUTVisualizacao")[1].textContent:""},s=function(t){return t.querySelectorAll("input")[5]?t.querySelectorAll("input")[5].value:""},l=function(t,e){var n=60*t.getHours()+t.getMinutes(),o=60*e.getHours()+e.getMinutes(),r=o-n;return r>0?r:0},d=function(t){var e=s(t).replace(/(\d{2})_(\d{2})_(\d{4})/,"$2/$1/$3"),n=new Date(e+" "+a(t)),r=new Date(e+" "+i(t)),d=new Date(e+" "+c(t)),h=new Date(e+" "+u(t));l(n,r),l(d,h),l(n,r),l(d,h);return{day:e.replace(/\d{2}\/(\d{2})\/\d{4}/,"$1"),month:e.replace(/(\d{2})\/\d{2}\/\d{4}/,"$1"),formatedEN:e.replace(/(\d{2})\/(\d{2})\/(\d{4})/,"$3-$1-$2"),formatedPT:e.replace(/(\d{2})\/(\d{2})\/(\d{4})/,"$2/$1/$3"),date:e,start:n,isHoliday:evaluatorHoliday.verifyDate(n),countableDay:!1,dayOfWeek:n.getDay(),s:o(n),e:o(r),s1:o(d),e1:o(h),accumulation:l(n,r)+l(d,h)}},h=function(t,e){for(var n=[],o=$(t).find(".DiaApontamento"),r=0;r<o.length;r++){var a=d(o[r]);a.month==e&&n.push(a)}return n},f=function(t,e){for(var n=0;n<t.length;n++)if(t[n]&&t[n].day&&1*t[n].day==1&&t[n].month&&1*t[n].month==e)return!0;return!1},g=function(t){for(var e=0,n=0;n<t.length;n++)t[n]&&t[n].accumulation&&1*t[n].accumulation>0&&(e+=1*t[n].accumulation);return{accumulation:e,hour:parseInt(e/60),min:e%60}},m=function(t){for(var e=[],n=0;n<t.length;n++)for(var o=0;o<t[n].length;o++)e.push(t[n][o]);for(var a=0,i=0,n=0;n<e.length;n++)e[n]&&e[n].accumulation&&(a+=1*e[n].accumulation),e[n]&&e[n].countableDay&&(i+=1);var c=r(i),u=a-c;return{accumulation:a,hour:parseInt(a/60),min:a%60,needed:c,neededHour:parseInt(c/60),neededMin:c%60,saldo:u,saldoHour:Math.abs(parseInt(u/60)),saldoMin:Math.abs(u%60)}};return{searchDaysFromWeek:function n(o,r,a,i,c){t.dtoPessoaApontamentos.Week=r,t.dtoPessoaApontamentos.IdPeriodo=o;var u=[];$.ajax({complete:function(){retrivingPonto=0},url:"/Dimep/Ponto/BuscarApontamentos",type:"POST",contentType:"application/json; charset=utf-8",dataType:"html",data:JSON.stringify(dtoPessoaApontamentos),success:function(t){var c=t.replace(/\<scrip[\s\S]*?\<\/script\>/gi,"");if(u=u.concat(h(c,a)),f(u,a))i({week:u,final:!0});else{if(u.length>0){u.sort(function(t,e){return e.day-t.day});var s=new Date(u[0].start);s.minusDay();var l=e.getPeriod(s);o!=l&&(r=1),o=l}n(o,r-1,a,i),i({week:u,final:!1})}},error:function(t,e,n){t.responseText.indexOf("/Account/LogOn")>=0&&t.responseText.indexOf(".indexOf('/Account/LogOn')")<0&&location.reload()}})},getAccumulationWeek:g,getAccumulation:m}}(window,PeriodManager);require("core-js/modules/es6.array.sort"),formatNumber=function(t){return("0"+t).slice(-2)},getHour=function(t){return formatNumber(parseInt(t/60))+"h "+formatNumber(t%60)+"min"},getFormatedTr=function(t,e){return'<tr style="background-color:'.concat(e,';">\n            <td>').concat(cronosUtil.getDayName(t.dayOfWeek),"</td>\n            <td>").concat(t.formatedPT,"</td><td>").concat(t.s,"</td>\n            <td>").concat(t.e,"</td><td>").concat(t.s1,"</td>\n            <td>").concat(t.e1,"</td><td>").concat(getHour(t.accumulation),"</td></tr>")},getDefaultTr=function(t,e){return'<tr style="background-color:'.concat(e,';">\n            <td>').concat(cronosUtil.getDayName(t.dayOfWeek),"</td>\n            <td>").concat(t.formatedPT,"</td><td>-</td>\n            <td>-</td><td>-</td>\n            <td>-</td><td>-</td></tr>")},getColor=function(t,e){return t<e?"red":"#0bb50bd4"},getWeekReport=function(t){var e=t[0],n=t[t.length-1],o=0,r='<table border="1" style="border-collapse: collapse;">\n        <tr><th colspan="7">Semana de '.concat(e.formatedPT," à ").concat(n.formatedPT,"</th></tr>\n        <tr>\n            <th>dia da semana</th>\n            <th>dia do mês</th>\n            <th>Entrada</th>\n            <th>Saída para Almoço</th>\n            <th>Retorno do Almoço</th>\n            <th>Saída</th>\n            <th>Total</th>\n        </tr>"),a=0;t.forEach(function(t){var e=t.isHoliday?"#ff980073":"#fff";0==t.accumulation?r+=getDefaultTr(t,e):(o+=t.accumulation,r+=getFormatedTr(t,e)),t.countableDay&&a++});var i=cronosUtil.getWeekNeedTime(a);return r+='<tr>\n                <td colspan="6"> Tempo necessário: '.concat(getHour(i)," </td>\n                <td style='color:").concat(getColor(o,i),";'>").concat(getHour(o),"</td>\n            </tr></table><br><br>")},isHoliday=function(t){return t.isHoliday},isWeekEndDay=function(t){return 0==t.dayOfWeek||6==t.dayOfWeek},isWeekDay=function(t){return!isWeekEndDay(t)},isValidWeek=function(t){for(var e=0;e<t.length;e++){var n=t[e];if(isWeekDay(n)&&n.accumulation>0)return!0}return!1},processCountablesDays=function(t){t.forEach(function(t){isWeekDay(t)&&!isHoliday(t)&&(t.countableDay=!0)})},getMonthData=function(t,e){void 0!=sessionStorage.getItem("mes-".concat(t))&&"null"!=sessionStorage.getItem("mes-".concat(t))||e(t,JSON.parse(sessionStorage.getItem("mes-".concat(t))));var n=[],o=[],r=function(r){if(r.week.length>0&&(processCountablesDays(r.week),o=o.concat(r.week)),r.final){var a=[];o.sort(function(t,e){return t.day-e.day}).forEach(function(t){a.push(t),0!=t.dayOfWeek&&t!=o[o.length-1]||(isValidWeek(a)&&n.push(a),a=[])}),sessionStorage.setItem("mes-".concat(t),JSON.stringify(n)),e(t,n)}},a=(cronosUtil.getInitialWeek(t),PeriodManager.getPeriod((new Date).withMonth(t).withDay(28).adjustYear(t)));search.searchDaysFromWeek(a,0,t,r,null)};var month=(new Date).getMonth()+1,lastMonth=1==month?12:month-1,twiceLastMonth=1==lastMonth?12:lastMonth-1;buildMonthReport=function(t,e){return monthReport="<center><h1>Mês ".concat(cronosUtil.getMonthName(t),"</h1>"),e.forEach(function(t){monthReport+=getWeekReport(t)}),monthReport+"</center>"},enableBtn=function(t){return t.disabled=!1},changeByPlusButton=function(t){return t.classList.add("PlusButton")},processButton=function(t){enableBtn(t),changeByPlusButton(t)},buildButton=function(t,e,n){t.addEventListener("click",function(t,e){PDF.generate("","Relatório de ".concat(cronosUtil.getMonthName(t)),e),PDF.print()})},processMonthInfo=function(t,e){var n=search.getAccumulation(e);t.innerHTML=(n.saldo<0?"-":"+")+n.saldoHour+"h e "+n.saldoMin+"min",t.style.color=n.saldo<0?"red":"green"};var btn=viewManager.btnCurrentMonth;btn.addEventListener("click",function(){getMonthData(month,function(t,e){PDF.generate("","Relatório de ".concat(cronosUtil.getMonthName(t)),buildMonthReport(t,e)),PDF.print()})});var btnLastMonth=viewManager.btnLastMonth;btnLastMonth.addEventListener("click",function(){getMonthData(lastMonth,function(t,e){PDF.generate("","Relatório de ".concat(cronosUtil.getMonthName(lastMonth)),buildMonthReport(lastMonth,e)),PDF.print()})});var btnTwiceLastMonth=viewManager.btnTwiceLastMonth;btnTwiceLastMonth.addEventListener("click",function(){getMonthData(twiceLastMonth,function(t,e){PDF.generate("","Relatório de ".concat(cronosUtil.getMonthName(twiceLastMonth)),buildMonthReport(twiceLastMonth,e)),PDF.print()})});